<!DOCTYPE html>
<html>

  <head>
    <title>Bookbay</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%# <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
  <section class = "hero is-primary">
    <div class = "hero-body">
        <div class = "columns is-gapless">
          <div class = "column is-one-fifth">
            <p class = "title">
              <h1 class = "title">BookBay</h1>
            </p>
          </div>
          <div class = "column is-one-fifth">
              <%= button_to "Home",
              root_path, 
              method: :get%> 
          </div>
          <div class = "column ">
                <% if current_user %>
                  <h3>Welcome, <%= current_user.username %> !</h3>
          </div>
          <div class = "column">
                  <h3>Wallet Balance: $<%= number_with_precision current_user.wallet_balance, precision: 2  %> </h3>
          </div>
          <div class = "column">
                  <details> 
                    <summary> Your Cart </summary>
                    <p>------------------------------------------------------------------</p>
                    <% if @cart.empty? %>
                      <p> You cart is empty!</p>
                    <% else %>
                      <div class = "box">
                        <ul>
                          <% @cart.each do |book| %>
                            <li><%= book.title %> / $<%= number_with_precision book.price, precision: 2 %><p><%= button_to  '- remove from cart', remove_from_cart_path(book), method: :delete%></p></li>
                          <% end %>
                        </ul>
                      </div>
                    <p>------------------------------------------------------------------</p>
                          <% total_price = []%>
                          <%@cart.each do |book| %>
                            <% total_price.push(book.price)%>
                          <% end %>
                          <p>Subtotal: $<%= number_with_precision (total_price).sum, precision: 2%><p>
                          <p>-----------</p>
                          <p>+ CA Sales Tax: $<%= number_with_precision (total_price).sum * 1.0875 - (total_price).sum, precision: 2%><p>
                          <p>-----------</p>
                          <p>Final Total: $<%= number_with_precision (total_price).sum * 1.0875, precision: 2%><p>
                    <% end %>
                  <p><%= button_to  'checkout', checkout_cart_path, method: :post%></p>
                  <p>------------------------------------------------------------------</p>
                  </details>
        <div class = "column">
                  <%= button_to "Sell", 
                          new_book_path,
                          method: :get %>
        </div>
        <div class = "column">
                  <%= button_to "Log out",
                  destroy_user_session_path(@user),
                  method: :delete %>
        </div>
        <div class = "columns">
                <% else %> 
                  <p>Sign in to add items to your cart or leave reviews!</p>
                  <%= button_to "Sign in",
                  new_user_session_path,
                  method: :get  %>
                <% end %>
        </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <%= flash[:alert] %>
    <%= flash[:notice] %>

    <%= yield %>

    <p> You have visited this site <%= pluralize @visit_count, 'time'%></p> 
  </body>
  <footer class="footer">
  <div class="content has-text-centered">
    <p>
      <strong>Bulma</strong> by <a href="https://jgthms.com">Paul Srisawat</a>. The source code is licensed
      <a href="http://opensource.org/licenses/mit-license.php">MIT</a>. The website content
      is licensed <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY NC SA 4.0</a>.
    </p>
  </div>
</footer>
</html>
